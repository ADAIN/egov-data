<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset='utf-8' />
		<meta http-equiv="X-UA-Compatible" content="chrome=1" />
		<meta name="description" content="eGov-Data : 표준프레임워크와 Spring Data의 만남" />
		<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
		<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/prettify.css">
		<script type="text/javascript" src="javascripts/prettify.js"></script>
		<title>eGov-Data-iBatis Page</title>
	</head>
	
	<body onload="prettyPrint()">
		<!-- HEADER -->
		<div id="header_wrap" class="outer">
			<header class="inner">
				<a id="forkme_banner" href="https://github.com/spring-sprout/egov-data">Fork Me on GitHub</a>
				<h1 id="project_title">eGov-Data-iBatis</h1>
				<h2 id="project_tagline">표준프레임워크 eGov-Data-iBatis 가이드</h2>
				<section id="downloads">
					<a class="zip_download_link"
						href="https://github.com/spring-sprout/egov-data/zipball/master">Download
						this project as a .zip file</a> <a class="tar_download_link"
						href="https://github.com/spring-sprout/egov-data/tarball/master">Download
						this project as a tar.gz file</a>
				</section>
			</header>
		</div>

		<!-- MAIN CONTENT -->
		<div id="main_content_wrap" class="outer">
			<section id="main_content" class="inner">
				<h3>eGov-Data-iBatis Quick Start</h3>
				
				<p>이 가이드는 eGov-Data-iBatis 1.0.0 버전을 기준으로 작성되었습니다.</p>
				
				<h4>Setup</h4>
				<ol>
					<li>
						프로젝트 다운로드<br/>
						<pre class="prettyprint">git clone https://github.com/spring-sprout/egov-data.git</pre><br/>
					</li>
					<li>
						Maven을 사용해 jar 생성<br/>
						<pre class="prettyprint">mvn jar:jar</pre><br/>
					</li>
					<li>classpath에 target/egov-data-ibatis.[version].jar 추가</li>
				</ol>
				
				<h4>Domain</h4>
				<p>데이터베이스 스키마와 매핑되는 클래스를 작성합니다.</p>
<pre class="prettyprint">
public class SpringSprout {
	private Long id;
	private String name;
	
	// Getters and setters
}
</pre>
				
				<h4>Repository</h4>
				<p>Spring Data에서 Repository 인터페이스는 가장 핵심적인 역할을 합니다. 스키마의 PK 타입과 도메인 클래스를 제네릭 타입으로 선언한 뒤, 쿼리 메소드를 작성하면 이를 실제 쿼리로 만들어 주기 때문입니다. eGov-Data-iBatis는 그러한 역할 보단 iBatis 본래의 취지를 살려 여러분이 작성한 SqlMap 구문과 쿼리 메소드를 연결해 주는 역할을 합니다.</p>
<pre class="prettyprint">
public interface SpringSproutRepository extends SqlMapRepository&#60SpringSprout, Long&#62 {

	public List&#60SpringSprout&#62 findAll();
	
	public SpringSprout findByName(String name);
	
	public SpringSprout insert(SpringSprout springSprout);
	
	public void insertMap(Map&#60String, String&#62 map);
	
	public int update(SpringSprout springSprout);
	
	public int delete(Long id);
	
	// ..기타 다른 메소드
}
</pre>
				<p>SqlMapRepository 인터페이스를 확장해 SqlMap에 선언한 구문과 같은 의미를 지니도록 메소드를 정의하면, 실제 구현체를 만들 필요없이 바로 SqlMap 구문을 호출 가능합니다. 이때, 제네릭 타입으로 지정한 도메인 클래스의 이름이 SqlMap의 네임스페이스가 되고 메소드 이름은 각 구문의 id가 됩니다. 이것은 기본 전략으로 다른 매핑 전략을 제공할 예정입니다. 따라서 위의 Repository 인터페이스는 SpringSprout라는 네임스페이스를 가진 SqlMap과 연결됩니다.</p>
				
				<h5>Query Method</h5>
				<p>Repository 인터페이스에 정의한 메소드를 쿼리메소드라고 부르며 이름과 같이 메소드가 하나의 쿼리 역할을 하게 됩니다. eGov-Data-iBatis에선 Spring Data의 쿼리메소드와 역할이 조금 다릅니다. 쿼리메소드 자체가 하나의 쿼리를 담당한다기 보단 쿼리메소드 이름과 같은 SqlMap 구문을 호출하는 즉, 매퍼 역할을 맡습니다. 이것은 쿼리메소드 기본 전략이며 차후 어노테이션 등을 통해 쿼리메소드 이름과 다른 SqlMap 구문과 매핑 가능하도록 지원할 예정입니다. 쿼리메소드 파라미터로 Java 기본 타입이나 Domain, Map과 같은 객체를 넘겨줄 수 있습니다. 아직은 하나의 타입만을 넘길 수 있지만, 여러 개의 파라미터도 곧 지원될 것입니다.</p>
				
				<h4>SqlMap.xml</h4>
<pre class="prettyprint">
&#60?xml version="1.0" encoding="UTF-8"?&#62
&#60!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
	"http://ibatis.apache.org/dtd/sql-map-2.dtd"&#62
&#60sqlMap namespace="SpringSprout"&#62

	&#60typeAlias alias="SpringSprout" type="egov.data.ibatis.sample.domain.SpringSprout"/&#62

	&#60select id="findAll" resultClass="SpringSprout"&#62
		SELECT * FROM SPRINGSPROUT
	&#60/select&#62    
	&#60select id="findByName" parameterClass="string" resultClass="SpringSprout"&#62
		SELECT * FROM SPRINGSPROUT WHERE NAME = #name#
	&#60/select&#62
	&#60select id="findOne" parameterClass="long" resultClass="SpringSprout"&#62
		SELECT * FROM SPRINGSPROUT WHERE ID = #id#
	&#60/select&#62
	&#60insert id="insert" parameterClass="SpringSprout"&#62
		INSERT INTO SPRINGSPROUT(NAME) VALUES(#name#);
		&#60selectKey resultClass="long" keyProperty="id"&#62
			CALL IDENTITY()
		&#60/selectKey&#62
	&#60/insert&#62
	&#60insert id="insertMap" parameterClass="map"&#62
		INSERT INTO SPRINGSPROUT(NAME) VALUES(#name#);
		&#60selectKey resultClass="long" keyProperty="id"&#62
			CALL IDENTITY()
		&#60/selectKey&#62
	&#60/insert&#62
	&#60update id="update" parameterClass="SpringSprout"&#62
		UPDATE SPRINGSPROUT SET NAME = #name# WHERE ID = #id# 
	&#60/update&#62
    
&#60/sqlMap&#62
</pre>
				
				<h4>applicationContext.xml</h4>
				<p>여기에서는 테스트를 위해 내장형 DB를 사용했지만 iBatis가 지원하는 모든 DBMS를 사용 가능합니다. &#60ibatis:repositories&#62에 base-package 속성으로 특정 패키지를 지정하면 하위 패키지를 포함해 SqlMapRepository 타입의 클래스들을 자동으로 빈으로 등록합니다. 또한, &#60ibatis:repositories&#62에 중첩 태그로 &#60ibatis:repository&#62를 선언해 특정 클래스를 지정할 수도 있습니다.</p>
<pre class="prettyprint">
&#60?xml version="1.0" encoding="UTF-8"?&#62
&#60beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:jdbc="http://www.springframework.org/schema/jdbc"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="http://www.springframework.org/schema/jdbc http://www.springframework.org/schema/jdbc/spring-jdbc-3.0.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
		http://www.egovframe.org/schema/data/ibatis http://www.egovframe.org/schema/data/ibatis/egov-ibatis.xsd"&#62
	
	&#60jdbc:embedded-database id="dataSource" type="H2"&#62
		&#60jdbc:script location="classpath:sqlScript/schema.sql"/&#62
	&#60/jdbc:embedded-database&#62
    
    &#60bean id="sqlMapClient" class="org.springframework.orm.ibatis.SqlMapClientFactoryBean"&#62
        &#60property name="dataSource" ref="dataSource" /&#62
        &#60property name="configLocation" value="classpath:ibatis/sqlMapConfig.xml" /&#62
        &#60property name="mappingLocations" value="classpath:ibatis/sqlmap/*.xml" /&#62
    &#60/bean&#62
    
    &#60ibatis:repositories base-package="egov.data.ibatis.sample.repository"/&#62
	
&#60/beans&#62
</pre>
				
				<h4>Test</h4>
				<p>만들어 둔 Repository 인터페이스를 주입 받아 메소드를 호출하면 &#60도메인 클래스이름.메소드 이름&#62에 해당하는 SqlMap 구문이 호출됩니다.</p>
<pre class="prettyprint">
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration
public class SpringSproutRepositoryTest {

	@Autowired SpringSproutRepository repository;

	SpringSprout first, second, third;
	
	@Before
	public void setup() {
		first = new SpringSprout("miracle");
		second = new SpringSprout("daclouds");
		third = new SpringSprout("yunseok");
	}
	
	@Test
	public void testInsert() {
		int before = count();
		
		repository.insert(first);
		repository.insert(second);
		repository.insert(third);
		
		assertThat(count(), is(before + 3));
	}
	
	// ..기타 테스트 메소드
}
</pre>
				
			</section>
		</div>

		<!-- FOOTER  -->
		<div id="footer_wrap" class="outer">
			<footer class="inner">
				<p class="copyright">
					eGov-Data maintained by <a href="https://github.com/spring-sprout">spring-sprout</a>
				</p>
				<p>
					Published with <a href="http://pages.github.com">GitHub Pages</a>
				</p>
			</footer>
		</div>
	</body>
</html>